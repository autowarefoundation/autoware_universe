{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Parameters for Trajectory Optimizer Node",
  "type": "object",
  "definitions": {
    "trajectory_optimizer_node": {
      "type": "object",
      "properties": {
        "use_akima_spline_interpolation": {
          "type": "boolean",
          "default": false,
          "description": "Enable Akima spline interpolation for trajectory smoothing"
        },
        "use_eb_smoother": {
          "type": "boolean",
          "default": false,
          "description": "Enable Elastic Band smoother for trajectory smoothing"
        },
        "use_qp_smoother": {
          "type": "boolean",
          "default": true,
          "description": "Enable QP-based trajectory smoothing with explicit jerk constraints"
        },
        "fix_invalid_points": {
          "type": "boolean",
          "default": true,
          "description": "Remove repeated or invalid points, or points that go against the general trajectory direction"
        },
        "extend_trajectory_backward": {
          "type": "boolean",
          "default": true,
          "description": "Extend trajectory backward using ego pose history"
        },
        "trajectory_extender": {
          "$ref": "plugins/trajectory_extender.schema.json"
        },
        "trajectory_spline_smoother": {
          "$ref": "plugins/trajectory_spline_smoother.schema.json"
        },
        "trajectory_qp_smoother": {
          "$ref": "plugins/trajectory_qp_smoother.schema.json"
        },
        "trajectory_velocity_optimizer": {
          "$ref": "plugins/trajectory_velocity_optimizer.schema.json"
        },
        "jerk_filter_params": {
          "type": "object",
          "properties": {
            "jerk_weight": {
              "type": "number",
              "default": 10.0,
              "minimum": 0,
              "description": "Weight for smoothness cost for jerk"
            },
            "over_v_weight": {
              "type": "number",
              "default": 100000.0,
              "minimum": 0,
              "description": "Weight for over speed limit cost"
            },
            "over_a_weight": {
              "type": "number",
              "default": 5000.0,
              "minimum": 0,
              "description": "Weight for over accel limit cost"
            },
            "over_j_weight": {
              "type": "number",
              "default": 2000.0,
              "minimum": 0,
              "description": "Weight for over jerk limit cost"
            },
            "jerk_filter_ds": {
              "type": "number",
              "default": 0.1,
              "exclusiveMinimum": 0,
              "description": "Resampling ds for jerk filter [m]"
            }
          },
          "required": [
            "jerk_weight",
            "over_v_weight",
            "over_a_weight",
            "over_j_weight",
            "jerk_filter_ds"
          ]
        },
        "elastic_band_params": {
          "type": "object",
          "properties": {
            "common": {
              "type": "object",
              "properties": {
                "output_delta_arc_length": {
                  "type": "number",
                  "default": 0.5,
                  "exclusiveMinimum": 0,
                  "description": "Delta arc length for output trajectory [m]"
                },
                "output_backward_traj_length": {
                  "type": "number",
                  "default": 5.0,
                  "minimum": 0,
                  "description": "Backward length for backward trajectory from base_link [m]"
                }
              },
              "required": ["output_delta_arc_length", "output_backward_traj_length"]
            },
            "elastic_band": {
              "type": "object",
              "properties": {
                "option": {
                  "type": "object",
                  "properties": {
                    "enable_warm_start": {
                      "type": "boolean",
                      "default": true,
                      "description": "Enable warm start for optimization"
                    },
                    "enable_optimization_validation": {
                      "type": "boolean",
                      "default": false,
                      "description": "Enable optimization validation"
                    }
                  },
                  "required": ["enable_warm_start", "enable_optimization_validation"]
                },
                "common": {
                  "type": "object",
                  "properties": {
                    "num_points": {
                      "type": "integer",
                      "default": 100,
                      "minimum": 1,
                      "description": "Number of points for optimization"
                    },
                    "delta_arc_length": {
                      "type": "number",
                      "default": 1.0,
                      "exclusiveMinimum": 0,
                      "description": "Delta arc length for optimization [m]"
                    }
                  },
                  "required": ["num_points", "delta_arc_length"]
                },
                "weight": {
                  "type": "object",
                  "properties": {
                    "smooth_weight": {
                      "type": "number",
                      "default": 1.0,
                      "minimum": 0,
                      "description": "Weight for smoothness constraint"
                    },
                    "lat_error_weight": {
                      "type": "number",
                      "default": 0.001,
                      "minimum": 0,
                      "description": "Weight for lateral error constraint"
                    }
                  },
                  "required": ["smooth_weight", "lat_error_weight"]
                }
              },
              "required": ["option", "common", "weight"]
            },
            "ego_nearest_dist_threshold": {
              "type": "number",
              "default": 3.0,
              "minimum": 0,
              "description": "Distance threshold for ego nearest search [m]"
            },
            "ego_nearest_yaw_threshold": {
              "type": "number",
              "default": 1.046,
              "minimum": 0,
              "description": "Yaw threshold for ego nearest search [rad]"
            }
          },
          "required": [
            "common",
            "elastic_band",
            "ego_nearest_dist_threshold",
            "ego_nearest_yaw_threshold"
          ]
        }
      },
      "required": [
        "use_akima_spline_interpolation",
        "use_eb_smoother",
        "use_qp_smoother",
        "fix_invalid_points",
        "extend_trajectory_backward",
        "trajectory_extender",
        "trajectory_spline_smoother",
        "trajectory_qp_smoother",
        "trajectory_velocity_optimizer"
      ]
    }
  },
  "properties": {
    "/**": {
      "type": "object",
      "properties": {
        "ros__parameters": {
          "$ref": "#/definitions/trajectory_optimizer_node"
        }
      },
      "required": ["ros__parameters"]
    }
  },
  "required": ["/**"]
}
